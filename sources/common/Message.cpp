#include "stdafx.h"
#ifndef WIN32
#include "defines.h"
#include "Message.h"
#include <stdlib.h>
#endif


/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
Message::Message(uint size, uint8 v0) : allocated(0), used(0), data(0)
{
    if (Allocate(size))
    {
        PutByte(v0);
    }
}

//-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Message::Message(uint size, uint8 v0, uint8 v1) : allocated(0), used(0), data(0)
{
    if (Allocate(size))
    {
        PutByte(v0);
        PutByte(v1);
    }
}

//-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Message::Message(uint size, uint8 v0, uint16 v1, uint8 v2) : allocated(0), used(0), data(0)
{
    if (Allocate(size))
    {
        PutByte(v0);
        PutHalfWord(v1);
        PutByte(v2);
    }
}

//-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Message::~Message()
{
    Free();
}

//-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
void Message::PutByte(uint8 v0)
{
    if (used < allocated)
    {
        data[used++] = v0;
    }
}

//-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
void Message::PutHalfWord(uint16 v0)
{
    if (used < allocated)
    {
        BitSet16 bs(v0);
        PutByte(bs.byte0);
        PutByte(bs.byte1);
    }
}

//-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
bool Message::Allocate(uint size)
{
    Free();
    data = (uint8 *)malloc(size);
    if (data)
    {
        allocated = size;
    }
    return data != 0;
}

//-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
void Message::Free()
{
    if (allocated)
    {
        free(data);
    }
}
